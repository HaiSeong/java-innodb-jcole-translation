# InnoDB를 배우며: 핵심으로 가는 여정  
[원문 보기](https://blog.jcole.us/2013/01/02/on-learning-innodb-a-journey-to-the-core/)

---

## InnoDB를 더 깊이 이해하게 된 계기

저(Jeremy Cole)는 InnoDB를 사용한 지 약 10년이 되었고, 대부분의 경우 원하는 대로 동작하도록 충분히 이해하고 있었습니다.  
하지만 성능과 관련된 몇 가지 목표를 달성하기 위해서는, 지금보다 더 깊은 수준의 이해가 필요하다고 느꼈습니다.  
안타깝게도 InnoDB 문서는 내부 데이터 구조에 대한 명확한 설명이 부족했습니다.  
결국 제가 필요한 정보를 찾기 위해 선택할 수 있었던 방법은 소스 코드를 직접 읽는 것이었습니다.

하지만 곧 깨달았습니다. 구조체 자체와 그 활용 방식, 특히 이들 간의 상호 관계는 단순히 코드를 읽는 것만으로는 머릿속에 온전히 정리하기에는 너무 복잡했습니다.  
또한 코드만으로 구조를 정확히 이해했다고 확신하기는 어려웠고 그 과정에서 많은 오해를 겪었습니다.  

제가 복잡하고 문서가 부족한 대상을 이해할 때 오랫동안 사용해온 방식은 다음 세 단계입니다:

1. 기존 문서와 코드를 충분히 읽으며 기본적인 이해를 얻습니다.  
   이 단계에서는 종종 심각한 오해나 잘못된 구조 해석이 발생하곤 합니다.

2. 아주 간단하고 불완전하더라도 직접 구현해봅니다.  
   가능하면 기존과 전혀 다른 언어로 구현하여 복사·붙여넣기 습관을 피합니다.  
   어떤 부분이 작동하고 어떤 부분이 그렇지 않은지를 바탕으로 이해를 점검하고 수정합니다.

3. 새롭게 이해한 내용을 기반으로 문서와 도표를 작성합니다.  
   구현한 코드를 리팩터링하는 과정에서 코드의 구조적 오류를 발견하게 되고 새로운 인식을 문서에 반영합니다.  
   올바른 구조에 도달할 때까지 이 과정을 반복합니다.


## InnoDB의 디스크 기반 데이터 구조 구현하기

> 💡 원문에서는 Ruby를 사용하여 InnoDB의 구조를 구현하고 있습니다.  
> 하지만 이 프로젝트에서는 Java로 동일한 구조를 구현하고 있으며,  
> Java 개발자도 이해하기 쉽게 구조를 재해석하고 예제를 제공합니다.  
> Ruby에 익숙하지 않아도 문제없이 따라오실 수 있습니다.

저는 InnoDB의 디스크 기반 데이터 구조를 Ruby로 구현하기 위해 `innodb_ruby` 프로젝트를 시작했습니다.  
Ruby는 유연성이 뛰어나고 프로토타이핑 속도가 매우 빠르며, 개인적으로 가장 선호하는 언어이기도 해서 선택했습니다.  
사실 어떤 언어든 사용 가능하며, 성능은 크게 중요하지 않았습니다.  
다만 테스트 과정이 너무 느리면 반복 작업이 번거롭기 때문에, 어느 정도의 속도는 고려했습니다.

프로젝트를 시작한 지 얼마 되지 않아, InnoDB의 모든 페이지 타입에 공통적으로 존재하는 FIL 헤더를  
16KiB 페이지에서 간단히 파싱하는 기능을 구현할 수 있었습니다.  
몇 시간 후에는 INDEX 페이지 헤더까지 구현했고,  
“각 인덱스 페이지에 레코드가 몇 개인가”와 같은 기본적인 질문에도 바로 답할 수 있게 되었습니다.  
실제로 매우 유용한 결과였습니다.

그 이후에는 필요에 따라 다른 핵심 데이터 구조들을 하나씩, 그리고 필요한 순서대로 구현해 나갔습니다.  
이러한 과정을 통해 InnoDB 저장소 구조에 대한 이해를 점차 심화시킬 수 있었습니다.  
또한 Davi가 참여하여, 레코드 내 가변 길이 필드 처리처럼 복잡한 부분도 함께 구현해주었습니다.

현재는 InnoDB의 주요 데이터 구조를 읽을 수 있는 기본적인 읽기 전용 구현체가 완성되어 있는 상태입니다.


## InnoDB 디스크 구조 문서화하기

InnoDB의 내부 구조에 대해 어느 정도 자신 있게 설명할 수 있을 만큼 이해가 쌓였다고 느꼈습니다.  
전체적으로 틀리지 않은 수준의 도표를 만들 수 있겠다고 판단하여
InnoDB의 주요 디스크 기반 데이터 구조를 명확하고 이해하기 쉽게 시각화 하기 위해 `innodb_diagrams` 프로젝트를 시작했습니다.  
또한 도표는 OmniGraffle 도구를 활용해 제작하였습니다.

현재 시점에서는 테이블스페이스 파일(ibdataX, *.ibd)의 디스크 저장 형식 중  
Barracuda 포맷(COMPACT 레코드) 기반 테이블에 대한 대부분의 내용이 문서화되어 있습니다.  
다만 Antelope 포맷(REDUNDANT 레코드)와 InnoDB 압축 테이블, 그리고 로그 파일 포맷에 대한 문서는 아직 작업이 많이 남아 있는 상태입니다.

## 코드와 도표의 활용

지금은 인터랙티브한 데모에 활용할 수 있는 실제 코드와, 보조 자료로 사용할 수 있는 도표들이 갖춰졌습니다.  
이제는 InnoDB 내부의 흥미롭고 아직 잘 알려지지 않은 구조들에 대해 몇 편의 글을 쓸 계획입니다.  
관심 있게 지켜봐 주시기 바랍니다.
